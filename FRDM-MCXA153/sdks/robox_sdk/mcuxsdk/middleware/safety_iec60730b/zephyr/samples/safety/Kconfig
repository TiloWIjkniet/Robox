# Copyright 2025 NXP
# SPDX-License-Identifier: Apache-2.0

mainmenu "Safety iec60730b sample application"

config APP_SAFETY_THREAD_STACK_SIZE
	int "Safety test thread stack size"
	default 1024
	help
	  Stack size in bytes for the safety test thread.
	  This thread runs periodic safety tests and monitors system health.
	  Increase this value if the safety tests require more stack space.

config APP_SAFETY_THREAD_PRIORITY
	int "Safety test thread priority"
	default -16 
	help
	  Priority level for the safety test thread.
	  Lower values indicate higher priority.
	  By default set to the absolute highest priority -16 for critical safety functions.

config APP_SAFETY_PERIOD_MS
	int "Safety test execution period in milliseconds"
	default 1000
	help
	  Time period in milliseconds between safety test executions.
	  This determines how frequently the safety tests are run.
	  Shorter periods provide faster error detection but consume more CPU.
	  Longer periods reduce CPU usage but may delay error detection.

config APP_SAFETY_LOG_LEVEL
	int "Safety tests log level"
	default 3
	range 0 4
	depends on LOG
	help
	  Sets the log level for the safety tests module.
	  Levels: 0=OFF, 1=ERROR, 2=WARNING, 3=INFO, 4=DEBUG

choice APP_SAFETY_ERROR_ACTION
	prompt "Safety Error Action"
	default APP_SAFETY_ERROR_ACTION_INFINITE_LOOP
	help
	  Select the action to take when a safety error is detected.

config APP_SAFETY_ERROR_ACTION_INFINITE_LOOP
	bool "Infinite Loop"
	help
	  When a safety error is detected, disable interrupts and enter an infinite loop,
	  The system will be stuck in a loop, preventing further execution
	  while maintaining processor activity. This can be useful for
	  debugging or when a controlled hang is preferred over a no action.

config APP_SAFETY_ERROR_ACTION_RESET
	bool "System Reset"
	help
	  When a safety error is detected, immediately perform a cold system reset.
	  This allows for quick recovery from safety violations.

endchoice

config APP_SAFETY_TASK_WATCHDOG
    bool "Enable Safety Task Watchdog"
    default y
    depends on TASK_WDT
    help
      Enable task watchdog for safety monitoring. The task watchdog
      monitors the safety test thread and triggers a callback if
      the thread fails to feed the watchdog within the specified timeout.
      This provides an additional safety mechanism to detect thread
      failures or system hangs.

if APP_SAFETY_TASK_WATCHDOG

config APP_SAFETY_TASK_WATCHDOG_TIMEOUT_MS
    int "Task watchdog timeout in milliseconds"
    default 10000
    help
      Timeout value for the safety task watchdog in milliseconds.
      This should be larger than CONFIG_APP_SAFETY_TESTS_PERIOD_MS
      to allow for test execution time. If the safety thread doesn't
      feed the watchdog within this time, the callback will be triggered.

endif # APP_SAFETY_TASK_WATCHDOG

if IEC60730B_TEST_RAM

config APP_SAFETY_TEST_RAM_BUFFER_SIZE
	int "Safety RAM test buffer size in bytes"
	default 1024
	help
	  Size of the RAM buffer used for safety RAM testing.
	  This buffer is used to perform RAM integrity tests according to IEC60730B.

config APP_SAFETY_TEST_RAM_BACKUP_BUFFER_SIZE
	int "Safety RAM test backup buffer size in bytes"
	default 32
	help
	  Size of the backup buffer used during RAM safety testing.
	  This buffer stores the original data while the main buffer is being tested.

endif #IEC60730B_TEST_RAM

if IEC60730B_TEST_STACK

config APP_SAFETY_TEST_STACK_GUARD_SIZE
	int "Stack test guard size for overflow detection"
	default 128
	help
	  Size in bytes of the guard areas placed before and after the stack
	  for overflow detection. The guard areas are filled with a test pattern
	  to detect stack overflow conditions.
	  Must be aligned to pointer size (4 bytes).

config APP_SAFETY_TEST_STACK_GUARD_PATTERN
	hex "Stack test gaurd pattern for overflow detection"
	default 0xA5A5A5A5
	help
	  32-bit pattern used to fill stack guard areas for overflow detection.
	  The pattern should be chosen to be easily detectable when corrupted
	  and unlikely to occur naturally in normal program execution.

endif #IEC60730B_TEST_STACK

source "Kconfig.zephyr"